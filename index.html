<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>奇点售后服务售后服务号测试页面</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        neutral: '#86909C',
                        light: '#F2F3F5',
                        dark: '#1D2129'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .form-input-focus {
                @apply focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none;
            }
            .btn-primary {
                @apply bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-all duration-300 shadow-md hover:shadow-lg;
            }
            .card {
                @apply bg-white rounded-xl shadow-md p-6 transition-all duration-300 hover:shadow-lg;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <div class="text-center mb-8">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-2">奇点售后服务系统</h1>
            <p class="text-neutral">故障信息提交测试</p>
        </div>
        
        <div class="card">
            <form id="faultForm" class="space-y-6">
                <div>
                    <label for="badReason" class="block text-sm font-medium text-gray-700 mb-1">故障原因 <span class="text-red-500">*</span></label>
                    <input type="text" id="badReason" name="badReason" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus"
                           placeholder="请输入故障原因" required>
                </div>
                
                <div>
                    <label for="badDesc" class="block text-sm font-medium text-gray-700 mb-1">故障描述 <span class="text-red-500">*</span></label>
                    <textarea id="badDesc" name="badDesc" rows="4"
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg form-input-focus"
                              placeholder="请详细描述故障情况" required></textarea>
                </div>
                
                <div class="flex justify-center pt-4">
                    <button type="submit" class="btn-primary flex items-center">
                        <i class="fa fa-paper-plane mr-2"></i> 提交故障信息
                    </button>
                </div>
            </form>
            
            <div id="resultMessage" class="mt-6 hidden p-4 rounded-lg"></div>
        </div>
        
        <div class="mt-8 text-center text-sm text-neutral">
            <p>© 2024 奇点科技 售后服务系统测试页面</p>
        </div>
    </div>

    <script>
        document.getElementById('faultForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('提交按钮被点击，开始处理...');
            
            // 获取表单数据
            const badReason = document.getElementById('badReason').value.trim();
            const badDesc = document.getElementById('badDesc').value.trim();
            
            // 简单验证
            if (!badReason || !badDesc) {
                showMessage('故障原因和故障描述不能为空', 'error');
                return;
            }
            
            // 准备请求数据 - 使用URLSearchParams替代FormData，更适合简单表单
            const params = new URLSearchParams();
            params.append('badReason', badReason);
            params.append('badDesc', badDesc);
            
            // 显示加载状态
            showMessage('正在提交数据...', 'info');
            
            // 调用后端接口
            console.log('准备调用接口:', 'http://test-it-openapi.jd-energy.com.cn:18081/mes/public/api/test/1');
            fetch('http://test-it-openapi.jd-energy.com.cn:18081/mes/public/api/test/1', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    // 如果需要跨域访问，添加这个头信息
                    'Access-Control-Allow-Origin': '*'
                },
                body: params,
                mode: 'cors' // 处理跨域请求
            })
            .then(response => {
                console.log('接口返回状态:', response.status);
                if (!response.ok) {
                    throw new Error(`请求失败，状态码: ${response.status}`);
                }
                // 尝试解析JSON，如果后端返回的不是JSON会抛出错误
                return response.text().then(text => {
                    try {
                        return JSON.parse(text);
                    } catch {
                        return text; // 如果不是JSON，直接返回文本
                    }
                });
            })
            .then(data => {
                showMessage('数据提交成功！', 'success');
                console.log('提交成功，返回数据:', data);
            })
            .catch(error => {
                showMessage(`提交失败: ${error.message}`, 'error');
                console.error('错误详情:', error);
                // 检查是否是跨域问题
                if (error.message.includes('CORS') || error.message.includes('跨域')) {
                    console.error('可能存在跨域问题，请联系后端开发人员添加CORS配置');
                }
            });
        });
        
        // 显示消息提示
        function showMessage(text, type) {
            const messageEl = document.getElementById('resultMessage');
            messageEl.textContent = text;
            messageEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
            
            switch(type) {
                case 'success':
                    messageEl.classList.add('bg-green-100', 'text-green-800');
                    break;
                case 'error':
                    messageEl.classList.add('bg-red-100', 'text-red-800');
                    break;
                case 'info':
                    messageEl.classList.add('bg-blue-100', 'text-blue-800');
                    break;
            }
        }
    </script>
</body>
</html>
    